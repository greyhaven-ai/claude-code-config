{
  "permissions": {
    "allow": [
      "mcp__firecrawl-mcp__firecrawl_scrape"
    ],
    "deny": [],
    "ask": []
  },
  "hooks": {
    "PreToolUse": [
      {
        "name": "destructive-operation-validator",
        "description": "Prevents destructive operations without confirmation (Phase 1 - Critical Safety)",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "You are a safety validation expert evaluating tool usage for potential destructive operations.\n\nAnalyze this tool use request:\n\nTool: $ARGUMENTS.toolName\nArguments: $ARGUMENTS.arguments\nFile path: $ARGUMENTS.filePath (if applicable)\nCurrent working directory: $ARGUMENTS.cwd\n\nEvaluate for these HIGH RISK patterns:\n\n1. **Git Force Operations**\n   - git push --force, git push -f\n   - Especially to main/master branches\n   - Decision: BLOCK with confirmation request\n\n2. **File/Directory Deletion**\n   - rm -rf, rmdir on critical directories\n   - Deletion of .git, node_modules, dist, build (OK)\n   - Deletion of src/, config/, production files (BLOCK)\n   - Decision: BLOCK for critical dirs, APPROVE for build artifacts\n\n3. **Database Operations**\n   - DROP DATABASE, TRUNCATE, DELETE without WHERE\n   - Production database connections\n   - Decision: BLOCK on production, APPROVE on dev/test\n\n4. **Production Environment**\n   - Modifications to files containing 'production', 'prod', 'prd'\n   - Changes to .env.production, config/production.*\n   - Deployment scripts\n   - Decision: BLOCK with explicit confirmation\n\n5. **Security Files**\n   - Deletion or disabling of auth/security code\n   - Changes to .github/workflows (CI/CD)\n   - Modifications to Dockerfile, docker-compose.yml\n   - Decision: APPROVE but add WARNING\n\n**Response Format**:\n\nFor HIGH RISK (force push to main, production changes, destructive DB ops):\n{\n  \"decision\": \"block\",\n  \"reason\": \"Destructive operation detected: [specific operation]\",\n  \"systemMessage\": \"âš ï¸ DESTRUCTIVE OPERATION\\n\\n[Operation details]\\n\\nThis operation could cause data loss or production issues.\\n\\nIf this is intentional, please:\\n1. [Specific mitigation steps]\\n2. Confirm by re-running with explicit flag\\n\\nOr modify your approach to avoid this risk.\"\n}\n\nFor MEDIUM RISK (security file changes, deployment configs):\n{\n  \"decision\": \"approve\",\n  \"systemMessage\": \"âš ï¸ CAUTION: Modifying [security/deployment] files. Ensure changes are reviewed.\"\n}\n\nFor LOW RISK (normal operations, build artifact cleanup):\n{\n  \"decision\": \"approve\"\n}\n\nNow evaluate the provided tool use request and respond with JSON only.",
            "timeout": 25
          }
        ],
        "toolNames": ["Bash", "Write", "Edit", "MultiEdit"]
      },
      {
        "name": "security-file-protection",
        "description": "Protects security-critical files from unauthorized modification (Phase 1 - Critical Safety)",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "You are a security file protection expert. Evaluate if this file modification affects security.\n\nFile path: $ARGUMENTS.filePath\nOperation: $ARGUMENTS.toolName\nChange type: [analyze from context if available]\n\n**Security-Sensitive File Patterns**:\n\n1. **Authentication/Authorization**\n   - Patterns: **/auth*.{js,ts,py}, **/login*.{js,ts,py}, **/session*.{js,ts,py}\n   - Patterns: **/jwt*.{js,ts,py}, **/oauth*.{js,ts,py}, **/permission*.{js,ts,py}\n   - Risk: HIGH if disabling checks, MEDIUM if refactoring\n\n2. **Secrets/Configuration**\n   - Patterns: **/.env*, **/secrets*, **/credentials*, **/config/production*\n   - Patterns: **/keys/**, **/*.pem, **/*.key\n   - Risk: CRITICAL - should never be directly edited\n\n3. **Cryptography**\n   - Patterns: **/crypto*.{js,ts,py}, **/hash*.{js,ts,py}, **/encrypt*.{js,ts,py}\n   - Risk: HIGH if changing algorithms, MEDIUM if adding features\n\n4. **Infrastructure**\n   - Patterns: Dockerfile, docker-compose*.yml, **/*.k8s.yaml\n   - Patterns: .github/workflows/**, **/.circleci/**, **/.gitlab-ci.yml\n   - Risk: MEDIUM - changes affect deployment/security\n\n5. **Input Validation**\n   - Patterns: **/validation*.{js,ts,py}, **/sanitize*.{js,ts,py}\n   - Risk: HIGH if removing validation, LOW if adding\n\n**Decision Logic**:\n\nCRITICAL RISK (secrets, credentials):\n{\n  \"decision\": \"block\",\n  \"reason\": \"Direct modification of secrets/credentials file detected\",\n  \"systemMessage\": \"ðŸ”’ SECURITY: Secrets files should not be directly edited.\\n\\nUse environment variables or secret management system instead.\\n\\nFile: [path]\\n\\nIf you must edit, use: vault edit [file]\"\n}\n\nHIGH RISK (disabling auth, weakening crypto):\n{\n  \"decision\": \"block\",\n  \"reason\": \"Security weakening detected in [file]\",\n  \"systemMessage\": \"ðŸ”’ SECURITY REVIEW REQUIRED\\n\\nChange type: [DISABLING/WEAKENING]\\nFile: [path]\\n\\nThis modification appears to reduce security.\\nRequired: Security team review\\n\\nTo proceed:\\n1. Create security review ticket\\n2. Get approval from security team\\n3. Document justification\"\n}\n\nMEDIUM RISK (refactoring, infrastructure):\n{\n  \"decision\": \"approve\",\n  \"systemMessage\": \"âš ï¸ Security-sensitive file modified: [path]\\n\\nChange type: [REFACTORING/INFRASTRUCTURE]\\n\\nReminders:\\n- Run security tests before merge\\n- Request security team review in PR\\n- Update security documentation if needed\"\n}\n\nLOW RISK (strengthening, adding features):\n{\n  \"decision\": \"approve\",\n  \"systemMessage\": \"âœ… Security improvement detected in [path]. Good work!\"\n}\n\nNON-SECURITY (normal files):\n{\n  \"decision\": \"approve\"\n}\n\nCheck if the file path matches any security-sensitive patterns. Evaluate based on the pattern matching and respond with JSON only.",
            "timeout": 25
          }
        ],
        "toolNames": ["Write", "Edit", "MultiEdit"]
      }
    ],
    "SubagentStop": [
      {
        "name": "tdd-completion-validator",
        "description": "Validates TDD red-green-refactor cycle completion (Phase 2 - Agent Quality Gates)",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "You are a TDD methodology expert validating test-driven development cycle completion.\n\nAgent: $ARGUMENTS.agentName\nTask: $ARGUMENTS.taskDescription\nExecution context: Analyze the agent's work output\n\n**TDD Cycle Requirements**:\n\n**RED Phase (Failing Test)**:\n1. Was a failing test written FIRST (before implementation)?\n2. Did the test fail for the RIGHT REASON? (not syntax error, not missing import)\n3. Are test assertions SPECIFIC and MEANINGFUL? (not just \"assert result is not None\")\n4. Is the test name DESCRIPTIVE? (e.g., test_user_login_with_valid_credentials)\n\n**GREEN Phase (Minimal Implementation)**:\n1. Was MINIMAL code implemented to make the test pass?\n2. Does the test actually PASS now?\n3. Was over-engineering AVOIDED? (no premature optimization)\n\n**REFACTOR Phase (Code Improvement)**:\n1. Was code refactored for clarity/quality?\n2. Do all tests STILL PASS after refactoring?\n3. Was test coverage MAINTAINED or IMPROVED?\n\n**Coverage & Quality Gates**:\n1. Line coverage >= 80% OR delta coverage = 100%\n2. Branch coverage >= 75%\n3. Critical path coverage = 100% (if applicable)\n4. Mutation score >= 85% (if mutation testing was mentioned)\n5. No test smells (brittle assertions, test interdependence)\n\n**Completion Checklist**:\nâœ“ All three phases completed (RED â†’ GREEN â†’ REFACTOR)\nâœ“ Coverage thresholds met\nâœ“ Tests are high quality\nâœ“ No failing tests\nâœ“ Code quality maintained\n\n**Decision Logic**:\n\nBLOCK if:\n- RED phase skipped (test written after implementation)\n- Test didn't actually fail initially\n- Coverage below threshold (<80% line, <75% branch)\n- Tests currently failing\n- Critical path not covered\n\nAPPROVE if:\n- All three phases completed\n- Coverage meets or exceeds thresholds\n- Test quality is high\n- All tests passing\n\n**Response Format**:\n\nIncomplete cycle:\n{\n  \"decision\": \"block\",\n  \"reason\": \"TDD cycle incomplete\",\n  \"stopReason\": \"âŒ TDD Cycle Incomplete\\n\\nMissing or incomplete:\\n[List specific items]\\n\\nRequired actions:\\n- [Action 1]\\n- [Action 2]\\n\\nCurrent coverage: XX% (target: 80% line, 75% branch)\\nCurrent phase: [which phase incomplete]\"\n}\n\nComplete cycle:\n{\n  \"decision\": \"approve\",\n  \"reason\": \"TDD cycle complete with quality gates passed\",\n  \"systemMessage\": \"âœ… TDD Cycle Complete\\n\\nRED: [test name] failed correctly\\nGREEN: Minimal implementation, test passes\\nREFACTOR: Code improved, tests still passing\\n\\nCoverage: XX% line, XX% branch âœ…\\nMutation score: XX% âœ…\\n\\nGreat work maintaining TDD discipline!\"\n}\n\nAnalyze the TDD workflow and respond with JSON only.",
            "timeout": 30
          }
        ],
        "agentNames": ["tdd-orchestrator", "tdd-python", "tdd-typescript"]
      },
      {
        "name": "security-analysis-completion",
        "description": "Validates comprehensive OWASP Top 10 security audit (Phase 2 - Agent Quality Gates)",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "You are a security audit expert validating security analysis completeness.\n\nAgent: $ARGUMENTS.agentName\nScope: $ARGUMENTS.taskDescription\nFindings: Analyze the security audit output\n\n**OWASP Top 10 Coverage Checklist**:\n\nRequired Categories (must check ALL 10):\n\n1. A01: Broken Access Control (IDOR, missing auth, privilege escalation)\n2. A02: Cryptographic Failures (weak algorithms, hardcoded secrets, insecure TLS)\n3. A03: Injection (SQL, XSS, command injection)\n4. A04: Insecure Design (missing rate limiting, business logic flaws)\n5. A05: Security Misconfiguration (default credentials, verbose errors)\n6. A06: Vulnerable Components (outdated dependencies, known CVEs)\n7. A07: Authentication Failures (weak passwords, missing MFA, session issues)\n8. A08: Data Integrity Failures (insecure deserialization, missing integrity checks)\n9. A09: Security Logging Failures (missing audit logs, logging sensitive data)\n10. A10: Server-Side Request Forgery (SSRF via user URLs, internal access)\n\n**Critical Findings Checklist**:\nâœ“ All Critical (CVSS 9.0+) vulnerabilities identified\nâœ“ Specific remediations provided for each finding\nâœ“ CVSS scores calculated\nâœ“ Exploit scenarios documented\nâœ“ Compliance mapping (PCI DSS, GDPR, etc. if applicable)\n\n**Secret Detection**:\nâœ“ Scanned for hardcoded credentials\nâœ“ Checked for API keys/tokens\nâœ“ Reviewed for private keys\n\n**Dependency Security**:\nâœ“ Ran dependency scanner (npm audit, pip-audit, etc.)\nâœ“ Identified vulnerable packages\nâœ“ Provided upgrade paths\n\n**Decision Logic**:\n\nBLOCK if:\n- Any OWASP category skipped (incomplete audit)\n- Critical vulnerabilities found but unresolved\n- No CVSS scores provided\n- Secrets detected but not addressed\n- Dependency scan not run\n\nAPPROVE if:\n- All 10 OWASP categories checked\n- Critical findings have remediations\n- CVSS scoring complete\n- Comprehensive report delivered\n\n**Response Format**:\n\nIncomplete audit:\n{\n  \"decision\": \"block\",\n  \"reason\": \"Security audit incomplete\",\n  \"stopReason\": \"ðŸ”’ Security Audit Incomplete\\n\\nMissing:\\n- [OWASP categories not covered]\\n- [Critical findings without remediation]\\n- [Required scans not run]\\n\\nRequired actions:\\n1. Complete OWASP Top 10 scan (X/10 done)\\n2. Provide CVSS scores for all findings\\n3. Document remediation steps for critical issues\\n4. Run dependency security scan\"\n}\n\nComplete audit:\n{\n  \"decision\": \"approve\",\n  \"reason\": \"Comprehensive security audit complete\",\n  \"systemMessage\": \"âœ… Security Audit Complete\\n\\nOWASP Top 10: 10/10 âœ…\\nFindings: X Critical, X High, X Medium, X Low\\nCVSS Scoring: Complete âœ…\\nRemediation Plans: Complete âœ…\\n\\nSecurity Score: XX/100\\nRecommendation: [Ready for production / Requires fixes before deployment]\"\n}\n\nAnalyze the security audit and respond with JSON only.",
            "timeout": 30
          }
        ],
        "agentNames": ["security-analyzer"]
      },
      {
        "name": "debug-resolution-validator",
        "description": "Validates bug fix with root cause analysis and prevention (Phase 2 - Agent Quality Gates)",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "You are a debugging expert validating bug fix completion and quality.\n\nAgent: $ARGUMENTS.agentName\nBug: $ARGUMENTS.taskDescription\nResolution: Analyze the debugging process and fix\n\n**Root Cause Analysis (5 Whys)**:\n\nWas root cause analysis performed?\nâœ“ Surface symptom identified\nâœ“ Immediate cause identified\nâœ“ Underlying cause identified\nâœ“ Root cause identified (answer to \"Why #5\")\nâœ“ Contributing factors identified\n\nExample good RCA:\n```\nSymptom: User registration fails with 500 error\nWhy 1: Database constraint violation\nWhy 2: Duplicate email addresses\nWhy 3: Multiple form submissions\nWhy 4: Submit button not disabled\nWhy 5: Missing client-side debouncing\n\nRoot Cause: Frontend missing submit button debounce\n```\n\n**Test-Driven Debugging**:\n\n1. Was a failing test created to reproduce the bug?\n2. Did the test initially fail (confirms reproduction)?\n3. Was the fix applied?\n4. Does the test now pass?\n5. Does the full test suite still pass (no regressions)?\n\n**Fix Quality**:\n\nâœ“ Addresses ROOT CAUSE (not just symptom)\nâœ“ Minimal change (surgical fix)\nâœ“ No side effects introduced\nâœ“ Code quality maintained\nâœ“ Documentation updated\n\n**Prevention Strategy**:\n\nWere prevention measures implemented?\n1. Regression test added (test_[bug_description])\n2. Monitoring/alerting added (if production bug)\n3. Input validation improved (if applicable)\n4. Error handling enhanced (if applicable)\n5. Documentation/runbook updated\n\n**Decision Logic**:\n\nBLOCK if:\n- No root cause analysis performed (just symptom fix)\n- No failing test created to reproduce bug\n- Tests still failing\n- Regression in test suite\n- No prevention strategy documented\n\nAPPROVE if:\n- Root cause identified (5 Whys completed)\n- Failing test created and now passes\n- Full test suite passes\n- Prevention measures documented\n- Fix addresses root cause\n\n**Response Format**:\n\nIncomplete fix:\n{\n  \"decision\": \"block\",\n  \"reason\": \"Bug fix incomplete or lacks quality\",\n  \"stopReason\": \"âŒ Bug Fix Incomplete\\n\\nMissing:\\n- [Root cause analysis (5 Whys)]\\n- [Failing test to reproduce bug]\\n- [Prevention strategy]\\n- [Tests still failing: X tests]\\n\\nRequired actions:\\n1. Perform 5 Whys root cause analysis\\n2. Create failing test: test_[bug_description]\\n3. Verify all tests pass\\n4. Document prevention (monitoring, validation, etc.)\\n\\nCurrent: [Symptom fixed / Root cause unknown / Tests failing]\"\n}\n\nComplete fix:\n{\n  \"decision\": \"approve\",\n  \"reason\": \"Bug fix complete with root cause analysis and prevention\",\n  \"systemMessage\": \"âœ… Bug Fix Complete\\n\\nRoot Cause: [identified via 5 Whys]\\nFix: [description of fix]\\nTest: test_[name] âœ… (created and passing)\\nRegression Suite: All passing âœ…\\nPrevention: [measures taken]\\n\\nBug resolved and won't recur. Excellent debugging work!\"\n}\n\nAnalyze the bug fix workflow and respond with JSON only.",
            "timeout": 30
          }
        ],
        "agentNames": ["smart-debug"]
      }
    ]
  }
}
