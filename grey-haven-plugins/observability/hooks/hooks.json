{
  "description": "Performance and observability monitoring - prevents performance regressions and ensures proper instrumentation",
  "hooks": {
    "Stop": [
      {
        "hooks": [
          {
            "type": "prompt",
            "prompt": "üìä PERFORMANCE REGRESSION DETECTOR\n\nContext: $ARGUMENTS\n\nAnalyze code changes for performance regressions and observability:\n\n1Ô∏è‚É£ N+1 QUERY DETECTION\n   - Queries inside loops?\n   - Multiple database calls for related data?\n   - Missing eager loading (JOIN/prefetch)?\n   - Should use batch queries?\n   ‚ö†Ô∏è BLOCK if N+1 queries detected\n\n2Ô∏è‚É£ ALGORITHMIC EFFICIENCY\n   - Nested loops over large datasets?\n   - O(n¬≤) or worse complexity?\n   - More efficient algorithm available?\n   - Large array operations in tight loops?\n   ‚ö†Ô∏è BLOCK if inefficient algorithms\n\n3Ô∏è‚É£ MEMORY LEAKS & RESOURCE MANAGEMENT\n   - Proper cleanup in finally blocks?\n   - Context managers used (with statements)?\n   - File handles/connections closed?\n   - Event listeners removed?\n   - Cache expiration configured?\n   ‚ö†Ô∏è BLOCK if resource leaks possible\n\n4Ô∏è‚É£ DATABASE PERFORMANCE\n   - Missing indices for query filters?\n   - Full table scans likely?\n   - Proper use of indices?\n   - Query pagination for large results?\n   ‚ö†Ô∏è BLOCK if missing critical indices\n\n5Ô∏è‚É£ API EFFICIENCY\n   - Excessive API calls?\n   - Missing request batching?\n   - No caching for repeated requests?\n   - Missing rate limiting considerations?\n   ‚ö†Ô∏è WARN if API inefficiency\n\n6Ô∏è‚É£ OBSERVABILITY INSTRUMENTATION\n   - Critical operations have metrics?\n   - Error rates tracked?\n   - Latency metrics present?\n   - Proper log levels used?\n   - Distributed tracing IDs?\n   ‚úÖ APPROVE if well-instrumented\n\n7Ô∏è‚É£ PERFORMANCE MONITORING\n   - Slow operations logged/tracked?\n   - Performance budgets considered?\n   - SLO/SLA compliance checked?\n   ‚ö†Ô∏è WARN if monitoring gaps\n\n8Ô∏è‚É£ CACHING STRATEGY\n   - Appropriate caching used?\n   - Cache invalidation correct?\n   - Cache keys well-designed?\n   - TTL values reasonable?\n\n9Ô∏è‚É£ ASYNC/PARALLEL OPTIMIZATION\n   - Async/await used for I/O?\n   - Parallel processing where applicable?\n   - Not blocking event loop?\n   - Worker pools sized appropriately?\n\nüîü SCALABILITY CONCERNS\n   - Will scale to 10x current load?\n   - No hardcoded limits?\n   - Handles concurrent requests?\n   - Database connection pooling?\n\nüö´ BLOCK if performance regressions detected.\nüö´ BLOCK if critical monitoring missing.\n‚ö†Ô∏è WARN for minor performance concerns.\n\nReturn JSON:\n{\n  \"decision\": \"approve\" or \"block\",\n  \"reason\": \"Detailed performance analysis with specific issues (line numbers, complexity estimates) if blocking, or performance confirmation if approving\"\n}",
            "timeout": 30
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "${CLAUDE_PLUGIN_ROOT}/hooks/scripts/analyze-performance.sh",
            "timeout": 45
          }
        ]
      }
    ]
  }
}
