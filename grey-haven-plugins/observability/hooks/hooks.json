{
  "description": "Performance and observability monitoring - prevents performance regressions and ensures proper instrumentation. Updated for Claude Code v2.0.74+ with SubagentStart hooks and model parameters.",
  "hooks": {
    "SubagentStart": [
      {
        "hooks": [
          {
            "type": "prompt",
            "model": "haiku",
            "prompt": "ðŸ“Š OBSERVABILITY CONTEXT INJECTION\n\nContext: $ARGUMENTS\n\nPrepare observability context for the starting subagent:\n\n1. PERFORMANCE BUDGET\n   - What latency thresholds apply?\n   - What complexity limits?\n\n2. MONITORING REQUIREMENTS\n   - What metrics should be instrumented?\n   - What logging patterns?\n\nProvide context:\n{\n  \"additionalContext\": \"Observability requirements for this task\",\n  \"performanceBudget\": \"p99 < 200ms\",\n  \"metricsToTrack\": [\"latency\", \"error_rate\"]\n}",
            "timeout": 10
          }
        ]
      }
    ],
    "SubagentStop": [
      {
        "hooks": [
          {
            "type": "prompt",
            "model": "haiku",
            "prompt": "ðŸ“Š SUBAGENT PERFORMANCE CHECK\n\nContext: $ARGUMENTS\n\nVerify subagent followed performance best practices:\n\nâœ… REQUIRED:\n1. No N+1 queries\n2. Efficient algorithms (O(n) or better)\n3. Proper resource cleanup\n4. Database indices considered\n5. Caching where appropriate\n\nâŒ BLOCK if:\n- N+1 queries detected\n- O(nÂ²) or worse algorithms\n- Resource leaks possible\n- Missing critical indices\n\nReturn JSON:\n{\n  \"decision\": \"approve\" or \"block\",\n  \"reason\": \"Performance assessment with specific issues if blocking\"\n}",
            "timeout": 20
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "prompt",
            "model": "haiku",
            "prompt": "ðŸ“Š PERFORMANCE REGRESSION DETECTOR\n\nContext: $ARGUMENTS\n\nAnalyze code changes for performance regressions and observability:\n\n1ï¸âƒ£ N+1 QUERY DETECTION\n   - Queries inside loops?\n   - Multiple database calls for related data?\n   - Missing eager loading (JOIN/prefetch)?\n   - Should use batch queries?\n   âš ï¸ BLOCK if N+1 queries detected\n\n2ï¸âƒ£ ALGORITHMIC EFFICIENCY\n   - Nested loops over large datasets?\n   - O(nÂ²) or worse complexity?\n   - More efficient algorithm available?\n   - Large array operations in tight loops?\n   âš ï¸ BLOCK if inefficient algorithms\n\n3ï¸âƒ£ MEMORY LEAKS & RESOURCE MANAGEMENT\n   - Proper cleanup in finally blocks?\n   - Context managers used (with statements)?\n   - File handles/connections closed?\n   - Event listeners removed?\n   - Cache expiration configured?\n   âš ï¸ BLOCK if resource leaks possible\n\n4ï¸âƒ£ DATABASE PERFORMANCE\n   - Missing indices for query filters?\n   - Full table scans likely?\n   - Proper use of indices?\n   - Query pagination for large results?\n   âš ï¸ BLOCK if missing critical indices\n\n5ï¸âƒ£ API EFFICIENCY\n   - Excessive API calls?\n   - Missing request batching?\n   - No caching for repeated requests?\n   - Missing rate limiting considerations?\n   âš ï¸ WARN if API inefficiency\n\n6ï¸âƒ£ OBSERVABILITY INSTRUMENTATION\n   - Critical operations have metrics?\n   - Error rates tracked?\n   - Latency metrics present?\n   - Proper log levels used?\n   - Distributed tracing IDs?\n   âœ… APPROVE if well-instrumented\n\n7ï¸âƒ£ PERFORMANCE MONITORING\n   - Slow operations logged/tracked?\n   - Performance budgets considered?\n   - SLO/SLA compliance checked?\n   âš ï¸ WARN if monitoring gaps\n\n8ï¸âƒ£ CACHING STRATEGY\n   - Appropriate caching used?\n   - Cache invalidation correct?\n   - Cache keys well-designed?\n   - TTL values reasonable?\n\n9ï¸âƒ£ ASYNC/PARALLEL OPTIMIZATION\n   - Async/await used for I/O?\n   - Parallel processing where applicable?\n   - Not blocking event loop?\n   - Worker pools sized appropriately?\n\nðŸ”Ÿ SCALABILITY CONCERNS\n   - Will scale to 10x current load?\n   - No hardcoded limits?\n   - Handles concurrent requests?\n   - Database connection pooling?\n\nðŸš« BLOCK if performance regressions detected.\nðŸš« BLOCK if critical monitoring missing.\nâš ï¸ WARN for minor performance concerns.\n\nReturn JSON:\n{\n  \"decision\": \"approve\" or \"block\",\n  \"reason\": \"Detailed performance analysis with specific issues (line numbers, complexity estimates) if blocking, or performance confirmation if approving\"\n}",
            "timeout": 30
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "${CLAUDE_PLUGIN_ROOT}/hooks/scripts/analyze-performance.sh",
            "timeout": 45
          }
        ]
      }
    ]
  }
}
