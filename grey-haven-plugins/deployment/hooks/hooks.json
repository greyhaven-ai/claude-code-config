{
  "description": "Deployment safety validation - prevents bad deployments and production incidents. Updated for Claude Code v2.0.74+ with SubagentStart, PermissionRequest hooks, and model parameters.",
  "hooks": {
    "SubagentStart": [
      {
        "hooks": [
          {
            "type": "prompt",
            "model": "haiku",
            "prompt": "üöÄ DEPLOYMENT CONTEXT PREPARATION\n\nContext: $ARGUMENTS\n\nPrepare deployment safety context for the subagent:\n\n1. ENVIRONMENT AWARENESS\n   - What environment is being targeted?\n   - What deployment tool is being used?\n   - What safety checks apply?\n\n2. ROLLBACK REQUIREMENTS\n   - Is a rollback plan required?\n   - What is the rollback procedure?\n\nProvide context:\n{\n  \"additionalContext\": \"Deployment safety requirements\",\n  \"environment\": \"staging or production\",\n  \"requiresRollbackPlan\": true\n}",
            "timeout": 10
          }
        ]
      }
    ],
    "PermissionRequest": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "prompt",
            "model": "haiku",
            "prompt": "üöÄ DEPLOYMENT COMMAND PERMISSION\n\nContext: $ARGUMENTS\n\nEvaluate if this is a safe deployment command:\n- Is it targeting the correct environment?\n- Is it a known safe deployment tool?\n- Are there destructive flags?\n\nReturn JSON:\n{\n  \"decision\": \"approve\" or \"block\" or \"ask\",\n  \"reason\": \"Brief safety assessment\"\n}",
            "timeout": 10
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "prompt",
            "model": "haiku",
            "prompt": "üöÄ DEPLOYMENT SAFETY CHECK\n\nContext: $ARGUMENTS\n\nYou are validating deployment commands before execution. Be extremely strict - bad deployments can take down production.\n\n1Ô∏è‚É£ ENVIRONMENT VERIFICATION (CRITICAL)\n   - Is this targeting the correct environment?\n   - Not accidentally deploying to production?\n   - Environment variables set correctly?\n   - Deployment context clear?\n   ‚ö†Ô∏è BLOCK if environment unclear or wrong\n\n2Ô∏è‚É£ DEPLOYMENT COMMAND SAFETY\n   - Command is a known safe deployment tool?\n   - No destructive flags (--force, --delete, etc.)?\n   - Proper authentication in place?\n   - Command syntax correct?\n   ‚ö†Ô∏è BLOCK if command is unsafe\n\n3Ô∏è‚É£ ROLLBACK PLAN\n   - Can this deployment be rolled back?\n   - Previous version tagged/saved?\n   - Rollback procedure documented?\n   - Database migrations reversible?\n   ‚ö†Ô∏è BLOCK if no rollback plan\n\n4Ô∏è‚É£ BREAKING CHANGES\n   - Breaking changes properly handled?\n   - Backward compatibility maintained?\n   - Feature flags for gradual rollout?\n   - API versioning if needed?\n   ‚ö†Ô∏è BLOCK if breaking changes not handled\n\n5Ô∏è‚É£ DATABASE MIGRATIONS\n   - Migrations tested in staging?\n   - Migration rollback tested?\n   - No data loss risk?\n   - Migrations run before code deploy?\n   ‚ö†Ô∏è BLOCK if migrations risky\n\n6Ô∏è‚É£ DEPENDENCIES & BUILD\n   - Build successful?\n   - Dependencies up to date?\n   - No security vulnerabilities?\n   - Assets compiled/bundled?\n   ‚ö†Ô∏è BLOCK if build not ready\n\n7Ô∏è‚É£ PRE-DEPLOYMENT CHECKS\n   - All tests passing?\n   - Code reviewed and approved?\n   - CI/CD pipeline green?\n   - Security scans passed?\n   ‚ö†Ô∏è BLOCK if pre-checks failed\n\n8Ô∏è‚É£ PRODUCTION READINESS\n   - Health checks configured?\n   - Monitoring/alerting set up?\n   - Logging properly configured?\n   - Error tracking enabled?\n   ‚ö†Ô∏è WARN if monitoring missing\n\n9Ô∏è‚É£ DEPLOYMENT TIMING\n   - Deploying during safe hours (not Friday 5pm)?\n   - Team available for support?\n   - Low traffic period if possible?\n   ‚ö†Ô∏è WARN if timing risky\n\nüîü CONFIGURATION\n   - Environment config reviewed?\n   - Secrets properly set?\n   - Feature flags correct?\n   - Service URLs correct?\n   ‚ö†Ô∏è BLOCK if config issues\n\nüö´ BE EXTREMELY STRICT on production deployments.\nüö´ When in doubt, BLOCK and ask for clarification.\nüö´ Production incidents are costly - prevent them here.\n\nReturn JSON:\n{\n  \"decision\": \"approve\" or \"block\",\n  \"reason\": \"Detailed deployment risk assessment with specific concerns if blocking, or safety confirmation if approving. Include environment, command, and risk level.\"\n}",
            "timeout": 30
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "prompt",
            "model": "haiku",
            "prompt": "üöÄ FINAL DEPLOYMENT VALIDATION\n\nContext: $ARGUMENTS\n\nPerform final deployment readiness check:\n\n‚úÖ CONFIRM:\n1. Deployment was successful\n2. Health checks passing\n3. No errors in logs\n4. Metrics look normal\n5. Rollback plan ready if needed\n6. Team notified of deployment\n7. Documentation updated\n8. Monitoring alerts configured\n\n‚ùå BLOCK if:\n- Deployment appears to have failed\n- Health checks not passing\n- Errors detected in logs\n- Metrics show anomalies\n- Rollback needed but not ready\n- Production readiness concerns\n\nüí° For non-deployment work, approve immediately.\n\nReturn JSON:\n{\n  \"decision\": \"approve\" or \"block\",\n  \"reason\": \"Deployment status summary with any issues or approval confirmation\"\n}",
            "timeout": 30
          }
        ]
      }
    ]
  }
}
